service: tile-broker-lambda
frameworkVersion: '3'

plugins:
  - serverless-plugin-typescript
  - serverless-offline
provider:
  name: aws
  runtime: nodejs14.x

functions:
  app:
    handler: index.handler
    environment:
      S3_BUCKET: image-tile-mart
      S3_PATH_TILE_CACHE: tile-cache
      S3_PATH_STYLE_CONFIG: style-config
      RENDER_URL: https://x8feyahf46.execute-api.us-east-1.amazonaws.com/dev/tiles/
    events:
      - http: 'ANY /'

  fetchTile:
    handler: index.handler
    environment:
      S3_BUCKET: image-tile-mart
      S3_PATH_TILE_CACHE: tile-cache
      S3_PATH_STYLE_CONFIG: style-config
      RENDER_URL: https://x8feyahf46.execute-api.us-east-1.amazonaws.com/dev/tiles/
    events:
      - http: 'GET /tiles/{proxy+}'
